<% layout('layouts/boilerplate') %>

<h2>Season History</h2>
<p class="text-muted">View your results from past testing seasons</p>

<% if (seasons.length > 0) { %>
  <div class="row">
    <% seasons.forEach(season => { %>
      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="card-title mb-1"><%= season.name %></h5>
                <p class="text-muted mb-2" style="font-size: 0.85rem;">
                  Closed: <%= season.closedAt ? new Date(season.closedAt).toLocaleDateString() : 'N/A' %> |
                  <%= season.totalParticipants %> participants
                </p>
              </div>
              <a href="/tester/history/<%= season._id %>" class="btn btn-outline-primary btn-sm">View</a>
            </div>

            <% if (season.userPosition) { %>
              <div class="mt-2 p-2 rounded" style="background: #f8f9fa;">
                <div class="d-flex justify-content-between">
                  <div>
                    <small class="text-muted">Your Position</small>
                    <div class="fw-bold">#<%= season.userPosition %></div>
                  </div>
                  <div>
                    <small class="text-muted">Your Points</small>
                    <div class="fw-bold"><%= season.userPoints %></div>
                  </div>
                  <div>
                    <small class="text-muted">Reward</small>
                    <div>
                      <% if (season.userReward) { %>
                        <span class="badge bg-success"><%= season.userReward.prizeDescription || season.userReward.name %></span>
                      <% } else { %>
                        <span class="text-muted">-</span>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
            <% } else { %>
              <div class="text-muted mt-2" style="font-size: 0.85rem;">
                You did not participate in this season
              </div>
            <% } %>
          </div>
        </div>
      </div>
    <% }); %>
  </div>
<% } else { %>
  <div class="alert alert-info">
    No past seasons yet. Keep testing to participate in the current season!
  </div>
<% } %>
