<% layout('layouts/boilerplate') %>

<style>
  @media (max-width: 767.98px) {
    .leaderboard-rank { font-size: 1.25rem; }
    h2 { font-size: 1.5rem; margin-bottom: 1rem; }
  }
</style>

<h2>Clasificacion</h2>

<div class="table-responsive">
<table class="table">
  <thead>
    <tr>
      <th>Posicion</th>
      <th>Usuario</th>
      <th>Puntos</th>
      <th>Recompensa</th>
    </tr>
  </thead>
  <tbody>
    <% users.forEach((user, index) => { %>
      <% var pos = index + 1; %>
      <% var userReward = null; %>
      <% if (rewards) rewards.forEach(function(r) { if (!userReward && pos >= r.positionFrom && pos <= r.positionTo) userReward = r; }); %>
      <tr class="<%= user._id.toString() === currentUser._id.toString() ? 'table-warning' : '' %>">
        <td>
          <span class="leaderboard-rank rank-<%= pos %>"><%= pos %></span>
        </td>
        <td>
          <%= user.username %>
          <% if (user._id.toString() === currentUser._id.toString()) { %>
            <span class="badge bg-primary">Tu</span>
          <% } %>
        </td>
        <td><strong><%= user.points %></strong></td>
        <td>
          <% if (userReward) { %>
            <span class="badge bg-success"><%= userReward.prizeDescription || userReward.name %></span>
          <% } else { %>
            <span class="text-muted">-</span>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
</div>
